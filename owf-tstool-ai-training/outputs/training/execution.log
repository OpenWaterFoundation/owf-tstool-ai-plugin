=== DeepAR Water Level Training ===
Loading processed data...
Training data shapes:
  Historical: (4051, 1440, 13)
  Future weather: (4051, 168, 12)
  Target: (4051, 168)
  Features: ['temperature_2m', 'precipitation', 'evapotranspiration', 'et0_fao_evapotranspiration', 'snowfall', 'snow_depth', 'soil_moisture_0_to_1cm', 'soil_moisture_1_to_3cm', 'soil_moisture_3_to_9cm', 'soil_moisture_9_to_27cm', 'soil_moisture_27_to_81cm', 'relative_humidity_2m']
Normalizing data...
Fitting weather and water level scalers...
Scalers fitted.
Transforming training data...
Transforming test data...
Creating datasets...
Datasets created.
Creating data loaders...
Data loaders created.
Initializing model...
Using device: cpu
Model initialized.
Initializing optimizer and scheduler...
Optimizer and scheduler initialized.
Starting training loop...

--- Epoch 1/1 ---
  [train_epoch] Batch 10: Loss = 2.6428
  [train_epoch] Batch 20: Loss = 1.8167
  [train_epoch] Batch 30: Loss = 1.4279
  [train_epoch] Batch 40: Loss = 1.0050
  [train_epoch] Batch 50: Loss = 0.6730
  [train_epoch] Batch 60: Loss = 0.3369
  [train_epoch] Batch 70: Loss = 0.6720
  [train_epoch] Batch 80: Loss = 0.3752
  [train_epoch] Batch 90: Loss = 0.4641
  [train_epoch] Batch 100: Loss = 0.1282
  [train_epoch] Batch 110: Loss = 0.0545
  [train_epoch] Batch 120: Loss = -0.1083
  [train_epoch] Epoch finished. Avg Loss = 0.9730
  [validate_epoch] Batch 10: Loss = 3.6590
  [validate_epoch] Batch 20: Loss = 2.3011
  [validate_epoch] Batch 30: Loss = 1.0645
  [validate_epoch] Epoch finished. Avg Loss = 2.7465
  New best model saved at epoch 1.
  Epoch 1: Train Loss = 0.9730, Val Loss = 2.7465, Patience Counter = 0
Training loop finished.
Loading best model weights...
Best model loaded.
Running final evaluation...
  [validate_epoch] Batch 10: Loss = 3.6590
  [validate_epoch] Batch 20: Loss = 2.3011
  [validate_epoch] Batch 30: Loss = 1.0645
  [validate_epoch] Epoch finished. Avg Loss = 2.7465
Final validation loss: 2.7465
Inverse transforming predictions and targets...
Calculating final metrics...
Final Metrics:
  MSE: 1.0354
  RMSE: 1.0176
  MAE: 0.8755
  MAPE: 15.0860
Plotting training results...
Training results plotted and saved.
Saving model for Java deployment...
Model saved for Java deployment: model_for_java.pth
Model configuration saved: model_config.json
Model for Java saved.
Saving scalers...
Scalers saved.
Saving training history...
Training history saved.
Training completed successfully!
Files saved:
  - best_model.pth: Best model weights
  - model_for_java.pth: TorchScript model for Java
  - model_config.json: Model configuration
  - weather_scaler_final.pkl: Weather data scaler
  - water_scaler_final.pkl: Water level scaler
  - training_history.json: Training history

Sample prediction:
Predicted mean water level (next 7 days): [3.737215  4.2163367 4.468118  4.5729537 4.6220717 4.6457644 4.657478
 4.6655917 4.6674156 4.670738  4.674093  4.677026  4.680081  4.6811223
 4.681752  4.682419  4.6823874 4.682017  4.682098  4.6820626 4.682259
 4.6824765 4.6830683 4.6835804]
Predicted std water level (next 7 days): [3.018006  2.9734366 2.9402177 2.9302554 2.9303477 2.931505  2.9323814
 2.9332898 2.932214  2.93331   2.9342875 2.9351227 2.935804  2.936169
 2.936378  2.93656   2.9365659 2.9364731 2.9364603 2.93643   2.9364774
 2.9365208 2.9366708 2.9368107]
Actual water level (next 7 days): [[4.7000003]
 [4.69     ]
 [4.8      ]
 [4.885    ]
 [5.022    ]
 [5.096667 ]
 [5.19     ]
 [2.59     ]
 [5.23     ]
 [5.15     ]
 [5.14     ]
 [5.14     ]
 [5.11     ]
 [5.0899997]
 [5.04     ]
 [5.1      ]
 [5.0299997]
 [4.94     ]
 [4.93     ]
 [4.9      ]
 [4.91     ]
 [4.82     ]
 [4.81     ]
 [4.86     ]]
